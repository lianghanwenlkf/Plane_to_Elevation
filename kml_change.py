import math

def plane_to_elevation(raw_data, new_y, new_x_max, new_x_min, new_z_max, new_z_min):
    points = raw_data.split()

    # 解析每个点的坐标
    coordinates = []
    for point in points:
        x, y, z = map(float, point.split(','))
        coordinates.append((x, y, z))

    # 计算y值的最大值、最小值以及y0
    y_values = [y for _, y, _ in coordinates]
    y_max = max(y_values)
    y_min = min(y_values)
    y0 = (y_max + y_min) / 2

    # 处理每个点的坐标
    processed_points = []
    for x, y, z in coordinates:
        # 计算新的z值
        new_z = -(y - y0) * (2 * math.pi * 6371000 * math.cos(math.radians(x)) / 360)
        processed_points.append((x, new_y, new_z))

    # 获取x和z的范围
    x_values = [x for x, _, _ in processed_points]
    z_values = [z for _, _, z in processed_points]

    x_min, x_max = min(x_values), max(x_values)
    z_min, z_max = min(z_values), max(z_values)

    # 计算缩放比例
    x_scale = (new_x_max - new_x_min) / (x_max - x_min)
    z_scale = (new_z_max - new_z_min) / (z_max - z_min)

    # 进行坐标缩放
    final_points = []
    for x, y, z in processed_points:
        new_x = new_x_min + (x - x_min) * x_scale
        new_z = new_z_min + (z - z_min) * z_scale
        final_points.append((new_x, y, new_z))

    # 转换成所需格式并输出
    result = ' '.join([f"{x:.13f},{y:.13f},{z:.3f}" for x, y, z in final_points])
    print(result)


def main():
    # 打开原始kml文件，找到<coordinates>内容中的坐标，复制到raw_data中。
    raw_data = '118.8508035878251,31.84326584407545,0 118.8508047350832,31.84209986825753,0 118.850826720466,31.8427170379966,0 118.8518824008081,31.84268409850399,0 118.8490549342891,31.84196440757024,0 118.8508054229698,31.84196791853685,0 118.8527256177907,31.84197550534914,0 118.8507796789396,31.84196820080319,0 118.8507755105901,31.84024362100018,0 118.8508028394525,31.84148740764373,0 118.8524154409262,31.84048966095744,0 118.8549176506474,31.8432318885487,0 118.8548822193303,31.84200008899811,0 118.8548606079882,31.84261698250213,0 118.8558374125722,31.84260913284745,0 118.853572719625,31.84196792520638,0 118.8548565479888,31.84200032000795,0 118.85691055054,31.84200386297077,0 118.8548050347137,31.84197883513804,0 118.8548171245112,31.84022928015441,0 118.8547508569038,31.84160652553653,0 118.8568123204394,31.84021140199476,0 118.8582046173857,31.84273780354015,0 118.8595946878674,31.84279323613615,0 118.8596222813605,31.84143139238908,0 118.8581352276517,31.84146664921936,0 118.8580931788113,31.84033069312361,0 118.8601408964847,31.84035590582051,0 118.8600840893826,31.84283288401074,0 118.8615766628581,31.84286352137988,0 118.8615985170969,31.84029918676845,0 118.8600385420034,31.8403568252417,0 118.8621107466017,31.84031637987375,0 118.8639536730825,31.84032158452126,0 118.8621373228054,31.84035975343385,0 118.8621620909862,31.84145235974611,0 118.8638548196071,31.84143711970375,0 118.8638987685911,31.84280077722681,0 118.8622186734702,31.84281369338042,0 118.8638897925913,31.84277663218414,0 118.866434466374,31.84270964888722,0 118.8645076147016,31.84279309250651,0 118.8644172778968,31.8413663444412,0 118.8664182332234,31.84137019184046,0 118.8664068746372,31.84019043594799,0 118.8643637012287,31.84033969631158,0 118.8643738581001,31.83977323256027,0 118.8494214856888,31.83973331365104,0 118.8494228880132,31.83929882070278,0 118.8522821142842,31.83925160391222,0 118.849425684687,31.83843212802316,0 118.852228780066,31.83834224708005,0 118.8503679113149,31.83896503725338,0 118.8503691938502,31.83796993820801,0 118.8490547497919,31.83603456548195,0 118.8503946008848,31.83801289414453,0 118.8513374197079,31.83902142498274,0 118.851284758488,31.83628359757843,0 118.852557815055,31.83764835304727,0 118.8532486916667,31.83848454050736,0 118.8533474258924,31.83781385522702,0 118.8539272856194,31.8368825990085,0 118.8547120636262,31.83651041918456,0 118.8560305843608,31.83634841221076,0 118.8561391066721,31.83701331923507,0 118.8552021701221,31.83805327577545,0 118.8545655775259,31.83835986459287,0 118.8545390051793,31.83769023382375,0 118.8549711113399,31.83742900891843,0 118.8556092058474,31.83798600363502,0 118.8563759160044,31.83832750909063,0 118.856833210384,31.83806512150897,0 118.8577249537664,31.83803809479389,0 118.8572069326034,31.83707146072588,0 118.8576992795403,31.83801664826642,0 118.8580444156127,31.83920781376323,0 118.8579211272512,31.83730369070372,0 118.8579342814371,31.83616662101024,0 118.8578963984601,31.83736840460724,0 118.8579804814963,31.83810139468142,0 118.8586358211601,31.83749317122075,0 118.8587775763038,31.83863776654942,0 118.8599280034789,31.83863131621811,0 118.8607716964994,31.83866963447946,0 118.8612500715256,31.83834151052331,0 118.8612676876605,31.83797359545128,0 118.8611038872496,31.83745676268131,0 118.8602362733209,31.83735440383015,0 118.8591927672839,31.8373176568251,0 118.8587861316015,31.83732001642199,0 118.8598794575612,31.83731351036014,0 118.8608938560866,31.83726469582357,0 118.8617101817927,31.8372593506821,0 118.8611302421054,31.83749969197634,0 118.8603999091985,31.83797880216939,0 118.8598543359927,31.83880544510742,0 118.8599181534246,31.83954533302105,0 118.8599272547666,31.83858792890567,0 118.8597899613847,31.83802572574914,0 118.8597505560222,31.83722831637071,0 118.8594859144976,31.83662939039288,0 118.858969339302,31.83599141989881,0 118.8595108986996,31.83660784498507,0 118.8598763420571,31.8371415256059,0 118.8604755422753,31.83653697088547,0 118.861048952607,31.83608475768584,0 118.8615531165392,31.83593193439805,0 118.8620228022937,31.83650621484272,0 118.8622218833805,31.83842231065221,0 118.8637910348964,31.83882513608177,0 118.8653581903407,31.83928344409214,0 118.8640893748961,31.83883341210143,0 118.8626336372562,31.83854991167447,0 118.862643532624,31.83794367743722,0 118.8627025907588,31.83727486916721,0 118.8627483890597,31.83708104916203,0 118.863327191805,31.83719239797698,0 118.8642444595888,31.83722993220296,0 118.8652106860915,31.83720252589676,0 118.8660542996229,31.83719711030371,0 118.8653514345804,31.8373664497873,0 118.8644504235668,31.83784633337292,0 118.8640976285169,31.8379781014013,0 118.8641262348187,31.83724473611437,0 118.8641319587074,31.83660055147003,0 118.8640830970432,31.83583129507409,0 118.864074644418,31.83555436653688,0 118.8632819383585,31.83648337102224,0 118.8627449010355,31.83633657099171,0 118.8623789174084,31.83591084522462,0 118.8647629944242,31.83648961977568,0 118.8654637361214,31.83620722782083,0 118.8657779769911,31.83577836210596,0 '
    # 指定纬度
    new_y = 31.83320226948283
    # 指定经度范围
    new_x_max = 118.8585
    new_x_min = 118.8580
    # 指定高度范围
    new_z_max = 32
    new_z_min = 12
    # 转换函数
    plane_to_elevation(raw_data, new_y, new_x_max, new_x_min, new_z_max, new_z_min)


if __name__ == "__main__":
    main()
